(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{"N0+D":function(t,e,a){"use strict";var n=a("OZBR"),i=a.n(n);i.a},OZBR:function(t,e,a){},rLap:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",{attrs:{padding:""}},[a("div",[a("span",{staticClass:"q-display-1 text-primary text-weight-bold",attrs:{color:"positive"}},[t._v("\n\t\t\t\t游戏大厅\t\n\t\t\t")]),a("p",{staticClass:"text-faded q-caption"},[t._v("\n\t\t\t\t欢迎进入《火车站——群魔乱舞》游戏大厅，在这里你可以新建游戏火车，也可以加入到朋友的火车中，和他们一起游戏！祝您玩的愉快！\n\t\t\t")])]),a("div",{staticClass:"row  justify-between text-faded ",staticStyle:{"font-size":"12px"}},[a("div",[a("q-btn",{class:{active:"active"==t.listby},attrs:{dense:"",flat:""},on:{click:function(e){t.listby="active",t.getMeta()}}},[t._v("最近活跃")]),t._v(" | \n\t\t\t\t"),a("q-btn",{class:{active:"active"!=t.listby},attrs:{dense:"",flat:""},on:{click:function(e){t.listby="date",t.getMeta()}}},[t._v("最新增加")])],1),a("q-btn",{staticClass:"text-orange text-weight-bold",attrs:{dense:"",flat:""},on:{click:function(e){t.newTrainDialog=!0}}},[t._v("新建火车")])],1),a("div",{staticClass:"row items-start justify-center",staticStyle:{clear:"both"}},[0==t.trains.length?a("q-card",{staticClass:"q-mt-md q-mx-sm trainCard",attrs:{inline:""}},[a("q-card-title",[t._v("\n\t\t\t\t\t没找到火车 \n\t\t\t\t")]),a("q-card-main",[a("dl",[a("dd",[t._v("网络不好，莫着急，阿姨等会儿给你再找找...")])])]),a("q-card-separator"),a("q-card-actions",{staticClass:"float-right"})],1):t._e(),t._l(t.trains,function(e){return e.open&&!e.destroyed?a("div",{staticClass:"col-xs-12 col-sm-6 col-md-4"},[a("q-card",{staticClass:"q-mt-md q-mx-sm trainCard ",attrs:{inline:""}},[a("q-card-title",{staticClass:"relative-position"},[a("span",{staticClass:"text-blue"},[t._v(t._s(e.id)+"号 ")]),t._v(t._s(e.name)+"\n\t\t\t\t\t\t"),a("span",{attrs:{slot:"subtitle"},slot:"subtitle"},[t._v("创建者："+t._s(t.eatAddr(e.creator)))]),1==e.type?a("q-btn",{staticClass:"absolute",staticStyle:{top:"0",right:"8px",transform:"translateY(-20%)"},attrs:{color:"red-5",label:"非公开"}}):t._e(),0==e.type?a("q-btn",{staticClass:"absolute",staticStyle:{top:"0",right:"8px",transform:"translateY(-20%)"},attrs:{color:"blue-5",label:"公开"}}):t._e()],1),a("q-card-main",[a("dl",[a("dt",{staticClass:"q-mt-sm"},[t._v("投注区间")]),a("dd",[t._v(t._s(e.minUnit)+" NAS - "+t._s(e.maxUnit)+" NAS")]),a("dt",{staticClass:"q-mt-sm"},[t._v("手续费")]),a("dd",[t._v(t._s(100*e.fee)+"%")]),a("dt",{staticClass:"q-mt-sm"},[t._v("当前战况")]),a("dd",[t._v(" 牌池金额： "+t._s(e.currentBets/Math.pow(10,18))+" NAS， 牌数："+t._s(e.currentLength)+" 张")]),a("dt",{staticClass:"q-mt-sm"},[t._v("简介")]),a("dd",[t._v(" "+t._s(e.introduction)+" ")])])]),a("q-card-separator"),a("q-card-actions",{staticClass:"row"},[a("q-btn",{attrs:{flat:"",color:"primary",icon:"share"},on:{click:function(a){t.share(e)}}}),a("div",{staticStyle:{flex:"1"}}),a("q-btn",{attrs:{icon:"train"},on:{click:function(a){t.goTrain(e)}}},[t._v(" 进入火车 ")])],1)],1)],1):t._e()})],2),a("q-modal",{attrs:{minimized:"","content-css":{padding:"20px"}},model:{value:t.newTrainDialog,callback:function(e){t.newTrainDialog=e},expression:"newTrainDialog"}},[a("div",{staticClass:"q-display-1 q-mb-md"},[t._v("新建火车")]),a("p",{staticClass:"q-body-2 text-red"},[t._v("注：需抵押1 NAS,关停时可取出")]),a("q-field",{attrs:{label:"火车名",orientation:"vertical"}},[a("q-input",{attrs:{color:"orange"},model:{value:t.newTrain.name,callback:function(e){t.$set(t.newTrain,"name",e)},expression:"newTrain.name"}})],1),a("q-field",{attrs:{label:"最低投注",orientation:"vertical"}},[a("q-input",{attrs:{color:"orange",type:"number",suffix:"NAS"},model:{value:t.newTrain.minUnit,callback:function(e){t.$set(t.newTrain,"minUnit",e)},expression:"newTrain.minUnit"}})],1),a("q-field",{attrs:{label:"最高投注",orientation:"vertical"}},[a("q-input",{attrs:{color:"orange",type:"number",suffix:"NAS"},model:{value:t.newTrain.maxUnit,callback:function(e){t.$set(t.newTrain,"maxUnit",e)},expression:"newTrain.maxUnit"}})],1),a("q-field",{attrs:{label:"手续费",orientation:"vertical"}},[a("q-input",{attrs:{color:"orange",type:"number",suffix:"%"},model:{value:t.newTrain.fee,callback:function(e){t.$set(t.newTrain,"fee",e)},expression:"newTrain.fee"}})],1),a("q-field",{attrs:{label:"火车类型",orientation:"vertical"}},[a("q-list",{attrs:{link:""}},[a("q-item",{attrs:{tag:"label"}},[a("q-item-side",[a("q-radio",{attrs:{val:"0"},model:{value:t.newTrain.type,callback:function(e){t.$set(t.newTrain,"type",e)},expression:"newTrain.type"}})],1),a("q-item-main",[a("q-item-tile",{attrs:{title:""}},[t._v("公开")]),a("q-item-tile",{attrs:{sublabel:""}},[t._v("所有人都可参与")])],1)],1),a("q-item",{attrs:{tag:"label"}},[a("q-item-side",[a("q-radio",{attrs:{color:"secondary",val:"1"},model:{value:t.newTrain.type,callback:function(e){t.$set(t.newTrain,"type",e)},expression:"newTrain.type"}})],1),a("q-item-main",[a("q-item-tile",{attrs:{label:""}},[t._v("不公开")]),a("q-item-tile",{attrs:{sublabel:""}},[t._v("之后可设置玩家列表")])],1)],1)],1)],1),a("q-field",{attrs:{label:"火车介绍",orientation:"vertical"}},[a("q-input",{attrs:{color:"orange",type:"textarea","max-height":100,rows:"3"},model:{value:t.newTrain.introduction,callback:function(e){t.$set(t.newTrain,"introduction",e)},expression:"newTrain.introduction"}})],1),a("div",{staticClass:"q-mt-xl float-right"},[a("q-btn-group",{attrs:{push:""}},[a("q-btn",{attrs:{color:"orange",glossy:"",push:"",label:"关闭"},on:{click:function(e){t.newTrainDialog=!1}}}),a("q-btn",{attrs:{color:"primary",glossy:"",push:"",label:"确认"},on:{click:t.createNewTrain}})],1)],1)],1),a("q-modal",{attrs:{minimized:"","content-css":{padding:"20px"}},model:{value:t.newTrainSuccess,callback:function(e){t.newTrainSuccess=e},expression:"newTrainSuccess"}},[a("div",{staticClass:"q-display-1 q-mb-md"},[t._v("创建成功")]),a("p",[t._v("房间编号："+t._s(t.newTrainIdReturned))]),a("div",{staticClass:"q-mt-xl float-right"},[a("q-btn-group",{attrs:{push:""}},[a("q-btn",{attrs:{color:"primary",glossy:"",push:"",label:"前往查看"},on:{click:t.gotoNewTrain}})],1)],1)]),a("q-modal",{attrs:{minimized:"","content-css":{padding:"20px"}},model:{value:t.shareDialog,callback:function(e){t.shareDialog=e},expression:"shareDialog"}},[a("div",{staticClass:" q-mb-md"},[t._v("复制以下链接，发送给朋友")]),a("q-field",{attrs:{label:"火车页面",orientation:"vertical"}},[a("q-input",{attrs:{color:"orange",value:t.shareUrl}})],1)],1),a("q-inner-loading",{attrs:{visible:t.loading}},[a("q-spinner-gears",{attrs:{size:"50px",color:"primary"}})],1)],1)},i=[];n._withStripped=!0;a("9VmF"),a("f3/d");var s={data:function(){return{listby:"active",trains:[],loading:!1,meta:{},isMobile:null,isDesktop:null,isIOS:null,isAndroid:null,blockchain:null,contract:null,newTrainDialog:!1,lastValue:null,newCard_amount:0,newTrain:{name:"",minUnit:.01,maxUnit:2,introduction:"",fee:0,type:"0",players:[]},network:"mainNet",nebPay_mainnetUrl:"https://pay.nebulas.io/api/mainnet/pay",nebPay_testnetUrl:"https://pay.nebulas.io/api/pay",newTrain_interval:-1,newTrainSuccess:!1,newTrainIdReturned:-1,shareUrl:"",shareDialog:!1}},mounted:function(){this.isMobile=this.$q.platform.is.mobile,this.isDesktop=this.$q.platform.is.desktop,this.isIOS=this.$q.platform.is.ios,this.isAndroid=this.$q.platform.is.android,this.blockchain=this.$store.state.blockchain.blockchain,this.contract=this.$store.state.blockchain.contract,this.loading=!0,setTimeout(this.getMeta,1e3,"active",20)},computed:{address:function(){var t=this.$store.state.blockchain.address;return t||this.$q.localStorage.get.item("address")}},methods:{share:function(t){this.shareUrl="http://"+location.host+"/#/train/"+t.id,this.shareDialog=!0},gotoNewTrain:function(){this.$router.push("/train/"+this.newTrainIdReturned)},createNewTrain:function(){console.log(this.newTrain);var t=this,e=t.newTrain;if(e.name)if(e.name.length>10)t.$q.notify({type:"negative",message:"火车名字长度超出10"});else if(e.minUnit<=0||e.maxUnit<=0)t.$q.notify({type:"negative",message:"投注金额输入错误"});else if(e.minUnit>e.maxUnit)t.$q.notify({type:"negative",message:"最低投注额大于最高投注额"});else if(e.introduction)if(e.introduction.length>100)t.$q.notify({type:"negative",message:"火车介绍长度超过100"});else if(e.fee>5||e.fee<0)t.$q.notify({type:"negative",message:"手续费只能在0%——5%之间"});else{e={name:e.name.substr(0,10),minUnit:parseFloat(e.minUnit).toFixed(3),maxUnit:parseFloat(e.maxUnit).toFixed(3),introduction:e.introduction.substr(0,100),type:parseInt(e.type),fee:(parseFloat(e.fee)/100).toFixed(3)};t=this;var a={goods:{name:"example"},qrcode:{showQRCode:!1,container:void 0,completeTip:void 0,cancelTip:void 0},extension:{openExtension:!0},mobile:{showInstallTip:!0,installTip:"请安装手机钱包"},callback:"mainNet"==t.network?t.nebPay_mainnetUrl:t.nebPay_testnetUrl,listener:void 0},n=t.contract,i="createNewTrain",s='["'.concat(e.name,'","').concat(e.minUnit,'", "').concat(e.maxUnit,'", "').concat(e.fee,'","').concat(e.type,'","').concat(e.introduction,'"]'),r=parseFloat(1);console.log(t.meta),console.log(t.meta.owner),console.log(t.address),t.meta.owner==t.address&&(r=parseFloat(0)),t.newTrainDialog=!1,t.serialNumber=t.blockchain.nebPay.call(n,r,i,s,a);clearInterval(t.newTrain_interval),t.newTrain_interval=-1;var l=0;t.newTrain_interval=setInterval(function(){if(l+=1,l>=40)return clearInterval(t.newTrain_interval),void(t.newTrain_interval=-1);t.blockchain.nebPay.queryPayInfo(t.serialNumber,{callback:"mainNet"==t.network?t.nebPay_mainnetUrl:t.nebPay_testnetUrl}).then(function(e){var a=JSON.parse(e);if(0==a.code){if(t.loading=!0,a.data.execute_result){t.loading=!1,console.log(a.data.execute_result);var n={};try{n=JSON.parse(a.data.execute_result)}catch(t){n={error:a.data.execute_result}}return n.error?(clearInterval(t.newTrain_interval),t.newTrain_interval=-1,void t.$q.notify({type:"warning",message:n.errMsg,timeout:5e3})):(t.loading=!1,clearInterval(t.newTrain_interval),t.newTrain_interval=-1,t.$store.commit("blockchain/setAddress",a.data.from),t.$q.localStorage.set("address",a.data.from),t.newTrainSuccess=!0,void(t.newTrainIdReturned=n.trainId))}t.$q.notify({type:"positive",message:"正在区块链上创建，请耐心等待!",timeout:1e3,position:"center"})}})},3500)}else t.$q.notify({type:"negative",message:"请输入火车介绍"});else t.$q.notify({type:"negative",message:"请输入火车名字"})},goTrain:function(t){var e=t.id;this.$router.push("/train/"+e)},eatAddr:function(t){if(t){var e="";return e=t.substr(0,4)+"...."+t.substr(-4,4),e}},getMeta:function(t,e){var a=this;t=this.listby;var n=this.address;n||(n=a.blockchain.Account.NewAccount().getAddressString()),e||(e=20);var i="0",s="0",r="1000000",l="2000000",o="getMeta",c='["'.concat(t,'","').concat(e,'"]'),d={function:o,args:c},m=a.contract;a.loading=!0,a.meta={},a.trains=[],a.blockchain.neb.api.call(n,m,i,s,r,l,d).then(function(t){a.loading=!1,!t.result.startsWith("Error")&&JSON.parse(t.result)&&(a.meta=JSON.parse(t.result),a.trains=a.meta.trains)}).catch(function(t){a.loading=!1,console.log("error:"+t.message)})}}},r=s,l=(a("N0+D"),a("KHd+")),o=Object(l["a"])(r,n,i,!1,null,null,null);e["default"]=o.exports}}]);