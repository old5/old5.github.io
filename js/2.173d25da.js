(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[2],{"8Ntb":function(t,a,e){t.exports=e.p+"img/default.7a119fb.png"},GFRJ:function(t,a,e){"use strict";var s=e("Heo7"),r=e.n(s);r.a},Heo7:function(t,a,e){},MU9w:function(t,a,e){"use strict";e.r(a);var s=function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("q-page",{attrs:{padding:""}},[s("div",{staticClass:"relative-position"},[s("q-card",{staticClass:"relative-position"},[s("q-card-title",[s("span",{staticClass:"text-green text-weight-bold"},[t._v(t._s(t.trainId||0)+"号 ")]),t._v("火车概况\n\n          "),s("q-btn",{staticClass:"q-ml-md float-right text-green",attrs:{dense:"",round:"",icon:"fas fa-sync-alt",size:"sm"},on:{click:t.getMeta}}),s("q-btn",{staticClass:"q-ml-md float-right text-orange",attrs:{dense:"",round:"",size:"sm",icon:"fas fa-question"},on:{click:function(a){t.helpInfo=!0}}}),s("q-btn",{staticClass:"q-ml-md float-right text-green",attrs:{dense:"",round:"",icon:"share",size:"sm"},on:{click:t.share}})],1),s("q-card-separator"),s("q-card-main",{staticClass:"column"},[1==t.meta.type?s("span",{staticClass:"text-orange"},[t._v("\n            *注意，当前火车为私人火车，只有受邀用户才可上车。\n      ")]):t._e(),0==t.meta.open?s("span",{staticClass:"text-red"},[t._v("\n            *当前火车已被创建者关闭，请勿继续操作。\n      ")]):t._e(),s("div",{staticClass:"row"},[s("div",{staticClass:"column q-mr-md"},[s("span",{staticClass:"q-mr-sm"},[t._v("当前牌数："),s("strong",[t._v(t._s((t.meta.queue||[]).length))]),t._v(" 张")]),s("span",{staticClass:"q-mr-sm"},[t._v("牌池金额："),s("strong",[t._v(t._s((t.meta.currentBets/Math.pow(10,18)).toFixed(3)))]),t._v(" NAS")]),s("span",{staticClass:"q-mr-sm"},[t._v("手续费率："),s("strong",[t._v(t._s(100*t.meta.fee)+"%")])])]),s("div",{staticClass:"column "},[s("span",{staticClass:"q-mr-sm"},[t._v("最低出价："),s("strong",[t._v(t._s(parseFloat(t.meta.minUnit).toFixed(3)))]),t._v(" NAS")]),s("span",{staticClass:"q-mr-sm"},[t._v("最高出价："),s("strong",[t._v(t._s(parseFloat(t.meta.maxUnit).toFixed(3)))]),t._v(" NAS")]),s("span",{staticClass:"q-mr-sm"},[t._v("火车类型："),s("strong",[t._v(t._s(0==t.meta.type?"公开":"需邀请"))])])])]),s("dl",[s("dt",{staticClass:"q-mt-sm"},[t._v("创建者")]),s("dd",[s("router-link",{attrs:{to:"/player?pAddr="+t.meta.creator}},[t._v(t._s(t.meta.creator))])],1),s("dt",{staticClass:"q-mt-sm"},[t._v("说明")]),s("dd",[t._v(t._s(t.meta.introduction))])]),s("q-btn",{attrs:{flat:"",dense:""},on:{click:t.getCtPlayer}},[t._v("查看我的战况")])],1)],1),s("q-card",{staticClass:"q-mt-md relative-position"},[s("q-card-title",[t._v("\n      牌池\n      "),s("q-btn",{staticClass:"q-ml-md float-right text-green",attrs:{dense:"",round:"",icon:"fas fa-plus",size:"sm"},on:{click:t.newCard}})],1),s("q-card-separator"),s("q-card-main",[s("div",{staticClass:"q-my-md row "},[0==(t.meta.queue||[]).length?s("div",{staticClass:"q-ma-sm q-pa-sm shadow-4 card"},[s("img",{attrs:{src:e("8Ntb"),width:"80px"}})]):t._e(),t._l(t.cards,function(a,e){return s("div",{staticClass:"column q-ma-sm q-pa-sm shadow-4 relative-position card",style:{background:a.playerAddress==t.address?"lightblue":""},on:{click:function(a){t.openCardInfo(e)}}},[s("div",{staticClass:"absolute shadow-1 bg-yellow",staticStyle:{top:"-10px",left:"-10px"}},[t._v("\n            #"+t._s(e+1)+"\n          ")]),s("img",{attrs:{src:"../statics/cards/PNG/"+a.png+".png",width:"80px"}}),s("div",{staticClass:"cardFoot q-pt-sm row justify-center "},[s("span",{staticClass:"text-weight-bolder q-mx-sm "},[t._v(t._s((a.betNAS/Math.pow(10,18)).toFixed(3))+" ")]),s("span",{staticClass:"text-faded "},[t._v("NAS")])])])}),s("div",{staticClass:"column justify-center q-py-xl q-ma-sm q-pa-sm"},[s("q-btn",{staticStyle:{width:"80px"},attrs:{color:"green"},on:{click:t.newCard}},[t._v("出牌")])],1)],2)])],1),1==t.meta.type?s("q-card",{staticClass:"q-mt-md relative-position"},[s("q-card-title",[t._v("\n      允许的玩家列表 \n      "),s("q-btn",{staticClass:"q-ml-md float-right text-green",attrs:{dense:"",round:"",icon:"fas fa-plus",size:"sm"},on:{click:t.pre_addPlayers}})],1),s("q-card-separator"),s("q-card-main",t._l(t.allowedPlayers,function(a,e){return s("div",{staticStyle:{"font-size":"12px"}},[t._v("\n        #"+t._s(e+1)+"  "+t._s(a)+"\n      ")])}))],1):t._e(),s("q-table",{staticClass:"q-mt-md q-pb-sm",attrs:{title:"收割记录",data:t.tableData,columns:t.columns,"hide-bottom":"","visible-columns":["date","winner","cardsNum","nas"],pagination:t.pagination},on:{"update:pagination":function(a){t.pagination=a}},scopedSlots:t._u([{key:"body",fn:function(a){return s("q-tr",{staticClass:"cursor-pointer",attrs:{props:a},nativeOn:{click:function(e){t.rowClick(a.row)}}},t._l(a.cols,function(e){return s("q-td",{key:e.name,attrs:{props:a}},[t._v("\n        "+t._s(e.value)+"\n      ")])}))}}])}),s("div",{staticClass:"q-caption float-right text-faded"},[t._v("*仅显示最近15条")]),s("q-inner-loading",{attrs:{visible:t.loading}},[s("q-spinner-gears",{attrs:{size:"50px",color:"primary"}})],1)],1),s("q-modal",{staticClass:"relative-position",style:{background:t.win?"yellow":""},attrs:{minimized:"","content-css":{padding:"20px"}},model:{value:t.returned,callback:function(a){t.returned=a},expression:"returned"}},[t.win?s("div",{staticClass:"q-display-1 q-mb-md "},[t._v("收割成功")]):s("div",{staticClass:"q-display-1 q-mb-md"},[t._v("出牌成功")]),s("div",{staticClass:"column justify-center",staticStyle:{"align-items":"center"}},[s("img",{attrs:{src:"../statics/cards/PNG/"+(t.returnedCard.png||"default")+".png",width:"80px"}}),s("div",{staticClass:"q-mt-md"},[t._v("收割 "+t._s(t.trade_cardsNum||0)+" 张牌，赚取 "+t._s(t.trade_nas||0)+" NAS")]),t.win?s("div",{staticClass:"q-caption text-faded float-right"},[t._v("*手续费率"+t._s(100*t.fee)+"%")]):t._e(),t.win?s("div",{staticClass:"absolute shadow-1 bg-yellow text-green",staticStyle:{top:"0px",right:"0px"}},[t._v("\n      收割成功\n    ")]):t._e()])]),s("q-modal",{staticClass:"relative-position",attrs:{minimized:"","content-css":{padding:"20px"}},model:{value:t.cardInfo,callback:function(a){t.cardInfo=a},expression:"cardInfo"}},[s("div",{staticClass:"q-display-1 q-mb-md"},[t._v("卡牌信息")]),s("div",{staticClass:"row"},[s("div",{staticClass:"q-mr-sm q-pt-sm"},[s("img",{staticClass:" shadow-1 ",attrs:{src:"../statics/cards/PNG/"+(t.curCard.png||"default")+".png",width:"60px"}})]),s("div",[s("p",[s("router-link",{attrs:{to:"/player?pAddr="+t.curCard.playerAddress}},[t._v("玩家："+t._s(t.curCard.shortAddr))])],1),s("p",[t._v("出价："+t._s(t.curCard.betNAS/Math.pow(10,18))+"   NAS")]),s("p",[s("router-link",{attrs:{to:"/train/"+t.curCard.trainId}},[t._v("火车编号："+t._s(t.curCard.trainId)+" ")])],1),s("p",{staticStyle:{"font-size":"12px"}},[t._v("时间："+t._s(t.curCard.dateStr))])])]),s("q-btn",{staticClass:"float-right",attrs:{color:"orange",label:"关闭"},on:{click:function(a){t.cardInfo=!1}}})],1),s("q-modal",{attrs:{minimized:"","content-css":{padding:"20px"}},model:{value:t.showTrade,callback:function(a){t.showTrade=a},expression:"showTrade"}},[s("div",{staticClass:"q-display-1 q-mb-md"},[t._v("收割记录")]),s("p",[t._v("收割者：\n    "),s("router-link",{attrs:{to:"/player?pAddr="+t.checkedTrade.winner}},[t._v(t._s(t.eatAddr(t.checkedTrade.winner)))]),t._v("(点击查看)\n  ")],1),s("p",[t._v("收割牌数: "+t._s(t.checkedTrade.cardsNum)+"   张")]),s("p",[t._v("金额："+t._s(t.checkedTrade.NAS/Math.pow(10,18))+"  NAS")]),s("p",[s("router-link",{attrs:{to:"/train/"+t.checkedTrade.trainId}},[t._v(" 火车编号："+t._s(t.checkedTrade.trainId)+" ")])],1),s("p",[t._v("时间："+t._s(new Date(1e3*t.checkedTrade.created).toLocaleString()))]),s("p",[t._v("收割卡牌:")]),s("div",{staticClass:"q-my-md row justify-center "},t._l(t.checkedTrade.cards,function(a,e){return s("div",{staticClass:"column q-ma-sm q-pa-sm shadow-4 relative-position card",style:{background:a.playerAddress==t.address?"lightblue":""},on:{click:function(e){t.openCardInfo_fromTrade(a)}}},[s("div",{staticClass:"absolute shadow-1 bg-yellow",staticStyle:{top:"-10px",left:"-10px"}},[t._v("\n        #"+t._s(e+1)+"\n      ")]),s("img",{attrs:{src:"../statics/cards/PNG/"+a.type+"-"+a.symbol+".png",width:"60px"}}),s("div",{staticClass:"cardFoot q-pt-sm row justify-center "},[s("span",{staticClass:"text-weight-bolder q-mx-sm "},[t._v(t._s(a.betNAS/Math.pow(10,18))+" ")]),s("span",{staticClass:"text-faded "},[t._v("NAS")])])])})),s("q-btn",{staticClass:"float-right",attrs:{color:"orange",label:"关闭"},on:{click:function(a){t.showTrade=!1}}})],1),s("q-modal",{attrs:{minimized:"","content-css":{padding:"20px"}},model:{value:t.helpInfo,callback:function(a){t.helpInfo=a},expression:"helpInfo"}},[s("div",{staticClass:"q-display-1 q-mb-md"},[t._v("开火车指南")]),s("p",[t._v("1. 每个人都可以请求出一张牌，系统会随机给你一张牌，放在队列的末尾")]),s("p",[t._v("2. 出牌的同时需要投注，金额不低于前一张牌的投注金额")]),s("p",[t._v("3. 如果你出的牌跟队列之前的某张牌"),s("strong",[t._v("数字")]),t._v("和"),s("strong",[t._v("花色")]),t._v("都一样，那么这两张牌中间的所有牌所附带的投注NAS都归你！")]),s("p",{staticClass:"text-red q-caption"},[t._v("*注意，您需要安装NAS钱包插件或手机NAS钱包")]),s("div",[s("q-btn",{staticClass:"q-my-md float-right",attrs:{color:"primary",label:"明白"},on:{click:t.readHelp}})],1)]),s("q-modal",{attrs:{minimized:"","content-css":{padding:"20px"}},model:{value:t.showCtPlayer,callback:function(a){t.showCtPlayer=a},expression:"showCtPlayer"}},[s("div",{staticClass:"q-display-1 q-mb-md"},[t._v("我的战况")]),s("p",[s("router-link",{attrs:{to:"/train/"+t.curCard.trainId}},[t._v("火车编号："+t._s(t.trainId)+" ")])],1),t.ctPlayer?s("div",[s("p",[t._v("已投入： "+t._s((t.ctPlayer.depositedNAS||0)/Math.pow(10,18))+" NAS")]),s("p",[t._v("出牌数： "+t._s(t.ctPlayer.cardsNum||0)+" 张")]),s("p",[t._v("共收割： "+t._s((t.ctPlayer.trades||[]).length)+" 次")]),s("p",[t._v("已赢得： "+t._s((t.ctPlayer.earnedNAS||0)/Math.pow(10,18))+" NAS")])]):s("p",[t._v("尚未出牌")])]),s("q-modal",{attrs:{minimized:"","content-css":{padding:"20px"}},model:{value:t.shareDialog,callback:function(a){t.shareDialog=a},expression:"shareDialog"}},[s("div",{staticClass:" q-mb-md"},[t._v("复制以下链接，发送给朋友")]),s("q-field",{attrs:{label:"火车页面",orientation:"vertical"}},[s("q-input",{attrs:{color:"orange",value:t.shareUrl}})],1)],1),s("q-modal",{attrs:{minimized:"","content-css":{padding:"20px"}},model:{value:t.newCardDialog,callback:function(a){t.newCardDialog=a},expression:"newCardDialog"}},[s("div",{staticClass:"q-display-1 q-mb-md"},[t._v("出牌\n    "),s("span",{staticClass:"q-body-2"},[t._v("目前"),s("strong",[t._v(t._s(t.meta.currentLength||0))]),t._v("张牌  共\n     "),s("strong",[t._v(" "+t._s((t.meta.currentBets||0)/Math.pow(10,18)))]),t._v("NAS")])]),s("q-field",{attrs:{label:"押注金额",orientation:"vertical",helper:"不得低于"+t.lastValue+" NAS(上一张牌金额)"}},[s("q-input",{attrs:{color:"orange",type:"number",suffix:"NAS"},model:{value:t.newCard_amount,callback:function(a){t.newCard_amount=a},expression:"newCard_amount"}})],1),s("div",{staticClass:"q-mt-xl float-right"},[s("q-btn-group",{attrs:{push:""}},[s("q-btn",{attrs:{color:"orange",glossy:"",push:"",label:"关闭"},on:{click:function(a){t.newCardDialog=!1}}}),s("q-btn",{attrs:{color:"primary",glossy:"",push:"",label:"确认"},on:{click:t.getACard}})],1)],1)],1),s("q-modal",{attrs:{minimized:"","content-css":{padding:"20px"}},model:{value:t.addPlayerDialog,callback:function(a){t.addPlayerDialog=a},expression:"addPlayerDialog"}},[s("div",{staticClass:"q-display-1 q-mb-md"},[t._v("添加玩家\n     "),s("span",{staticClass:"q-body-2"},[t._v("最多20,还剩"+t._s(20-this.allowedPlayers.length)+"个名额")])]),t._l(t.newPlayers,function(a,e){return s("div",{staticClass:"row items-end"},[s("q-field",{attrs:{label:"玩家"+e,orientation:"vertical"}},[s("q-input",{attrs:{color:"orange"},model:{value:t.newPlayers[e],callback:function(a){t.$set(t.newPlayers,e,a)},expression:"newPlayers[index]"}})],1),s("q-btn",{attrs:{icon:"fas fa-minus",dense:"",flat:"",round:""},on:{click:function(a){t.removeItem(e)}}}),e==t.newPlayers.length-1?s("q-btn",{attrs:{icon:"fas fa-plus",dense:"",flat:"",round:""},on:{click:t.addItem}}):t._e()],1)}),s("div",{staticClass:"q-mt-xl float-right"},[s("q-btn-group",{attrs:{push:""}},[s("q-btn",{attrs:{color:"orange",glossy:"",push:"",label:"关闭"},on:{click:function(a){t.addPlayerDialog=!1}}}),s("q-btn",{attrs:{color:"primary",glossy:"",push:"",label:"确认"},on:{click:t.addPlayers}})],1)],1)],2)],1)},r=[];s._withStripped=!0;e("a1Th"),e("rGqo"),e("yt8O"),e("T39b"),e("SRfc"),e("9VmF");var n={data:function(){return{shareUrl:"",shareDialog:!1,cardInfo:!1,isMobile:!0,isDesktop:!1,isIOS:!1,isAndroid:!0,newCardDialog:!1,newCard_amount:0,loading:!1,loading_cards:!1,loading_meta:!1,loading_trades:!1,meta:{},network:"mainNet",card_interval:-1,curCard:{},cards:[],lastValue:.01,nebPay_mainnetUrl:"https://pay.nebulas.io/api/mainnet/pay",nebPay_testnetUrl:"https://pay.nebulas.io/api/pay",returned:!1,returnedCard:{},returnedTrade:{},win:!1,columns:[{name:"date",label:"日期",field:"date"},{name:"winner",label:"玩家",field:"winner"},{name:"cardsNum",label:"牌数",field:"cardsNum"},{name:"nas",label:"金额",field:"nas"}],trade_cardsNum:0,trade_nas:0,fee:0,helpInfo:!1,showTrade:!1,checkedTrade:{},pagination:{sortBy:null,descending:!1,page:1,rowsPerPage:15},trainId:0,ctPlayer:null,showCtPlayer:!1,allowedPlayers:[],addPlayerDialog:!1,newPlayers:[""],newPlayers_interval:-1}},mounted:function(){this.isMobile=this.$q.platform.is.mobile,this.isDesktop=this.$q.platform.is.desktop,this.isIOS=this.$q.platform.is.ios,this.isAndroid=this.$q.platform.is.android,this.blockchain=this.$store.state.blockchain.blockchain,this.contract=this.$store.state.blockchain.contract,this.trainId=this.$route.params.id,console.log(this.$route.params),this.trainId||this.$router.push("/hall");var t=this.$q.localStorage.get.item("helpRead");t||(this.helpInfo=!0),this.loading=!0,setTimeout(this.getAllowedPlayers,800),setTimeout(this.getMeta,1e3)},computed:{address:function(){var t=this.$store.state.blockchain.address;return t||(this.isMobile?this.$q.localStorage.get.item("address"):void 0)},tableData:function(){if(!this.meta.trades||0==this.meta.trades.length)return[];var t=[];for(var a in this.meta.trades)if(this.meta.trades[a]){var e=this.meta.trades[a],s={};s.winner=this.eatAddr(e.winner);var r=new Date(1e3*e.created);s.date=r.getMonth()+1+"/"+r.getDate()+" "+r.getHours()+":"+r.getMinutes(),s.nas=parseInt(e.NAS)/Math.pow(10,18),s.cardsNum=e.cardsNum,s.id=e.id,s.player=e.winner,t.push(s)}return t}},methods:{addPlayers:function(){var t=this,a={goods:{name:"example"},qrcode:{showQRCode:!1,container:void 0,completeTip:void 0,cancelTip:void 0},extension:{openExtension:!0},mobile:{showInstallTip:!0,installTip:"请安装手机钱包"},callback:"mainNet"==t.network?t.nebPay_mainnetUrl:t.nebPay_testnetUrl,listener:void 0},e=t.contract,s="addAllowedPlayer";console.log(t.newPlayers.join("-"));var r='["'.concat(t.trainId,'","').concat(t.newPlayers.join("-"),'"]'),n=parseFloat(0);t.addPlayerDialog=!1,t.serialNumber=t.blockchain.nebPay.call(e,n,s,r,a);clearInterval(t.newPlayers_interval),t.newPlayers_interval=-1;var i=0;t.newPlayers_interval=setInterval(function(){if(i+=1,i>=40)return clearInterval(t.newPlayers_interval),void(t.newPlayers_interval=-1);t.blockchain.nebPay.queryPayInfo(t.serialNumber,{callback:"mainNet"==t.network?t.nebPay_mainnetUrl:t.nebPay_testnetUrl}).then(function(a){var e=JSON.parse(a);if(0==e.code){if(t.loading=!0,e.data.execute_result){t.loading=!1,console.log(e.data.execute_result);var s={};try{s=JSON.parse(e.data.execute_result)}catch(t){s={error:e.data.execute_result}}return s.error?(clearInterval(t.newPlayers_interval),t.newPlayers_interval=-1,void t.$q.notify({type:"warning",message:s.errMsg,timeout:5e3})):(t.loading=!1,clearInterval(t.newPlayers_interval),t.newPlayers_interval=-1,t.$store.commit("blockchain/setAddress",e.data.from),t.$q.localStorage.set("address",e.data.from),t.newTrainIdReturned=s.trainId,t.$q.notify({type:"positive",message:"添加成功!",timeout:5e3,position:"bottom"}),t.newPlayers=[""],void t.getAllowedPlayers(!0))}t.$q.notify({type:"positive",message:"正在写入区块链，请耐心等待!",timeout:1e3,position:"center"})}})},3500)},removeItem:function(t){this.newPlayers.splice(t,1)},addItem:function(){this.newPlayers.length+this.allowedPlayers.length>20?this.$q.notify({type:"negative",message:"玩家总数不能超过20"}):this.newPlayers.push("")},pre_addPlayers:function(){this.address==this.meta.creator?this.addPlayerDialog=!0:this.$q.notify({type:"negative",message:"您不是火车创建者，无法添加玩家"})},share:function(){this.shareUrl="https://old5.github.io/#/train/"+train.id,this.shareDialog=!0},getCtPlayer:function(){var t=this.trainId;if(t){t=parseInt(t);var a=this,e=this.address;e||(e=a.blockchain.Account.NewAccount().getAddressString());var s="0",r="0",n="1000000",i="2000000",o="getCtPlayer",l='["'.concat(t,'"]'),d={function:o,args:l},c=a.contract;a.loading=!0,a.blockchain.neb.api.call(e,c,s,r,n,i,d).then(function(t){if(a.loading=!1,t.result.startsWith("Error")||!JSON.parse(t.result))return a.ctPlayer=null,void(a.showCtPlayer=!0);a.ctPlayer=JSON.parse(t.result),a.showCtPlayer=!0}).catch(function(t){a.loading=!1,console.log("error:"+t.message)})}},getAllowedPlayers:function(t){var a=this.trainId;if(a){a=parseInt(a);var e=this,s=this.address;s||(s=e.blockchain.Account.NewAccount().getAddressString());var r="0",n="0",i="1000000",o="2000000",l="getAllowedPlayers",d='["'.concat(a,'"]'),c={function:l,args:d},u=e.contract;t&&(e.loading=!0),e.blockchain.neb.api.call(s,u,r,n,i,o,c).then(function(a){t&&(e.loading=!1),!a.result.startsWith("Error")&&JSON.parse(a.result)&&(e.allowedPlayers=JSON.parse(a.result),console.log(e.allowedPlayers))}).catch(function(a){t&&(e.loading=!1),console.log("error:"+a.message)})}},getTrade:function(t){if(t){t=parseInt(t);var a=this,e=this.address;e||(e=a.blockchain.Account.NewAccount().getAddressString());var s="0",r="0",n="1000000",i="2000000",o="getTrade",l='["'.concat(t,'"]'),d={function:o,args:l},c=a.contract;a.loading=!0,a.showTrade=!1,a.checkedTrade={},a.blockchain.neb.api.call(e,c,s,r,n,i,d).then(function(t){a.loading=!1,!t.result.startsWith("Error")&&JSON.parse(t.result)&&(a.checkedTrade=JSON.parse(t.result),a.showTrade=!0)}).catch(function(t){a.loading=!1,a.showTrade=!1,console.log("error:"+t.message)})}},rowClick:function(t){this.getTrade(t.id)},readHelp:function(){this.helpInfo=!1,this.$q.localStorage.set("helpRead",!0)},checkWX:function(){var t=window.navigator.userAgent.toLowerCase();return"micromessenger"==t.match(/MicroMessenger/i)},eatAddr:function(t){if(t){var a="";return a=t.substr(0,4)+"...."+t.substr(-4,4),a}},getMeta:function(){var t=this,a=this.address;a||(a=t.blockchain.Account.NewAccount().getAddressString());var e="0",s="0",r="1000000",n="2000000",i="getTrainMeta",o='["'.concat(t.trainId,'","14"]'),l={function:i,args:o},d=t.contract;t.loading=!0,t.meta={},t.cards=[],t.blockchain.neb.api.call(a,d,e,s,r,n,l).then(function(a){if(t.loading=!1,!a.result.startsWith("Error")&&JSON.parse(a.result)){t.meta=JSON.parse(a.result);var e=[];for(var s in t.meta.queue){var r=t.meta.queue[s];r.png=r.type+"-"+r.symbol,e.push(r)}t.cards=e}}).catch(function(a){t.loading=!1,console.log("error:"+a.message)})},newCard:function(){if(this.checkWX())this.$q.dialog({title:"微信浏览器受限",ok:!0,message:"请点击右上角菜单，选择在浏览器中打开"}).then(function(){}).catch(function(){});else{var t=this,a=this.address;if(a||(a=t.blockchain.Account.NewAccount().getAddressString()),1!=this.meta.type||new Set(this.allowedPlayers).has(a)){var e="0",s="0",r="1000000",n="2000000",i="getLastValue",o='["'.concat(t.trainId,'"]'),l={function:i,args:o},d=t.contract;t.loading=!0,t.blockchain.neb.api.call(a,d,e,s,r,n,l).then(function(a){console.log(a),t.loading=!1,a.result.startsWith("Error")||(t.lastValue=JSON.parse(a.result),t.lastValue||(t.lastValue=t.meta.minUnit),t.newCard_amount=t.lastValue,t.newCardDialog=!0)}).catch(function(a){t.loading=!1,console.log("error:"+a.message)})}else t.$q.notify({type:"negative",message:"您不在该火车的玩家列表中，无法出牌"})}},getACard:function(){var t=this,a={goods:{name:"example"},qrcode:{showQRCode:!1,container:void 0,completeTip:void 0,cancelTip:void 0},extension:{openExtension:!0},mobile:{showInstallTip:!0,installTip:"请安装手机钱包"},callback:"mainNet"==t.network?t.nebPay_mainnetUrl:t.nebPay_testnetUrl,listener:void 0},e=t.contract;t.newCard_amount=parseFloat(t.newCard_amount);var s=parseFloat(t.newCard_amount),r=parseFloat(t.lastValue),n=parseFloat(t.meta.maxUnit);if(s<r)t.$q.notify({type:"negative",message:"金额低于上一张牌("+r+")"});else if(s>n)t.$q.notify({type:"negative",message:"金额超出上限("+t.meta.maxUnit+")"});else{t.returned=!1,t.win=!1,t.trade_cardsNum=0,t.trade_nas=0,t.fee=0,t.returnedTrade={},t.returnedCard={},t.newCardDialog=!1;var i="giveMeCard",o='["'.concat(t.trainId,'","10"]');t.serialNumber=t.blockchain.nebPay.call(e,s,i,o,a);clearInterval(t.card_interval),t.card_interval=-1;var l=0;t.card_interval=setInterval(function(){if(l+=1,l>=40)return clearInterval(t.card_interval),void(t.card_interval=-1);console.log("hehe"),console.log(t.serialNumber),t.blockchain.nebPay.queryPayInfo(t.serialNumber,{callback:"mainNet"==t.network?t.nebPay_mainnetUrl:t.nebPay_testnetUrl}).then(function(a){var e=JSON.parse(a);if(0==e.code){if(t.loading=!0,e.data.execute_result){t.loading=!1,console.log(e.data.execute_result);var s={};try{s=JSON.parse(e.data.execute_result)}catch(t){s={error:e.data.execute_result}}return s.error?(clearInterval(t.card_interval),t.card_interval=-1,t.$q.notify({type:"warning",message:s.errMsg,timeout:5e3}),void t.getMeta()):(t.loading=!1,clearInterval(t.card_interval),t.card_interval=-1,t.$store.commit("blockchain/setAddress",e.data.from),t.$q.localStorage.set("address",e.data.from),t.returned=!0,t.returnedCard=s.card,t.returnedCard.png=s.card.type+"-"+s.card.symbol,s.trade&&(t.returnedTrade=s.trade),t.win=s.win,t.win&&(t.trade_cardsNum=s.trade_cardsNum,t.trade_nas=parseInt(s.trade_nas)/Math.pow(10,18),t.fee=s.fee),t.$q.notify({type:"positive",message:"出牌成功!",timeout:5e3,position:"bottom"}),void t.getMeta())}t.$q.notify({type:"positive",message:"区块链正在发牌，请耐心等待!",timeout:1e3,position:"center"})}})},3500)}},openCardInfo:function(t){this.curCard=this.meta.queue[t];var a=this.meta.queue[t].playerAddress;this.curCard.shortAddr=a.substr(0,6)+"...."+a.substr(-6,6),this.curCard.dateStr=new Date(1e3*this.curCard.created).toLocaleString(),this.cardInfo=!0},openCardInfo_fromTrade:function(t){this.curCard=t;var a=t.playerAddress;this.curCard.shortAddr=a.substr(0,6)+"...."+a.substr(-6,6),this.curCard.dateStr=new Date(1e3*t.created).toLocaleString(),this.curCard.png=t.type+"-"+t.symbol,this.cardInfo=!0}}},i=n,o=(e("GFRJ"),e("KHd+")),l=Object(o["a"])(i,s,r,!1,null,"31ed814c",null);a["default"]=l.exports}}]);